<!DOCTYPE html>
<html lang="de">
  <head>
    <meta charset="UTF-8" />
    <title>3D Punkt-Globus</title>
    <style>
      body {
        margin: 0;
        overflow: hidden;
        background: black;
      }
      #globeViz {
        width: 100vw;
        height: 100vh;
        position: absolute;
      }
    </style>
  </head>
  <body>
    <div id="globeViz"></div>

    <!-- Drei wichtige Libs -->
    <script src="https://unpkg.com/three"></script>
    <script src="https://unpkg.com/globe.gl"></script>
    <script src="https://unpkg.com/topojson@3"></script>

    <script>
      // 🌍 Globe initialisieren
      const world = Globe()
        (document.getElementById('globeViz'))
        .globeImageUrl('https://unpkg.com/three-globe/example/img/earth-dark.jpg')
        .backgroundColor('rgba(0, 0, 0, 0)')
        .showAtmosphere(false);

      // 🌐 Länder als Punktwolke laden
      fetch('https://unpkg.com/world-atlas@2.0.2/countries-110m.json')
        .then(res => res.json())
        .then(worldData => {
          const countries = topojson.feature(worldData, worldData.objects.countries).features;

          const pointsGeometry = new THREE.BufferGeometry();
          const positions = [];

          countries.forEach(country => {
            const coords = country.geometry.coordinates;

            const processCoords = (poly) => {
              poly.forEach(ring => {
                ring.forEach(coord => {
                  const lng = coord[0];
                  const lat = coord[1];

                  const phi = (90 - lat) * Math.PI / 180;
                  const theta = (lng + 180) * Math.PI / 180;

                  const radius = 100;
                  const x = radius * Math.sin(phi) * Math.cos(theta);
                  const y = radius * Math.cos(phi);
                  const z = radius * Math.sin(phi) * Math.sin(theta);

                  positions.push(x, y, z);
                });
              });
            };

            if (country.geometry.type === 'Polygon') {
              processCoords(country.geometry.coordinates);
            } else if (country.geometry.type === 'MultiPolygon') {
              country.geometry.coordinates.forEach(processCoords);
            }
          });

          pointsGeometry.setAttribute('position', new THREE.Float32BufferAttribute(positions, 3));

          const pointsMaterial = new THREE.PointsMaterial({
            color: 0x00ffff,       // türkisblau
            size: 0.7,             // Punktgröße
            transparent: true,
            opacity: 0.3,          // halb durchsichtig
            depthWrite: false      // wichtig für Rückseite sichtbar
          });

          const points = new THREE.Points(pointsGeometry, pointsMaterial);

          // Punkte zur Globe-Szene hinzufügen
          const threeScene = world.scene();
          threeScene.add(points);
        })
        .catch(err => console.error('Fehler beim Laden der Länder:', err));
    </script>
  </body>
</html>

